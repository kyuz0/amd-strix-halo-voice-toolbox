#!/usr/bin/env bash
set -euo pipefail

# defaults (can be overridden by CLI flags)
DEFAULT_MODEL_PATH="/mnt/storage/VibeVoice-Large/"
DEFAULT_PORT="8000"

# ensure our numba shim is found first and disable real JIT usage
export PYTHONPATH="/opt/vv_shims:${PYTHONPATH:-}"
export NUMBA_DISABLE_JIT=1
export LIBROSA_DISABLE_NUMBA=1

# build arg list, inject defaults only if missing
ARGS=()
if ! printf '%s\0' "$@" | grep -q -- '--model_path'; then
  ARGS+=(--model_path "$DEFAULT_MODEL_PATH")
fi
if ! printf '%s\0' "$@" | grep -q -- '--port'; then
  ARGS+=(--port "$DEFAULT_PORT")
fi

# hand off to the demo
exec /opt/venv/bin/python /opt/VibeVoice/demo/gradio_demo.py "${ARGS[@]}" "$@"
